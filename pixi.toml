[project]
name = "opencode-cortex"
version = "0.1.0"
description = "OpenCode with Snowflake Cortex integration"
channels = ["conda-forge"]
platforms = ["osx-arm64", "osx-64", "linux-64"]

[tasks]
# Setup tasks - run this first
setup = { cmd = "npm install -g bun && cd opencode-patched && bun install", description = "Install bun and OpenCode dependencies" }

# OpenCode tasks
dev = { cmd = "bun run dev", cwd = "opencode-patched", description = "Run patched OpenCode in dev mode" }
install = { cmd = "bun install", cwd = "opencode-patched", description = "Install OpenCode dependencies" }

# Proxy tasks (legacy - not needed with patched OpenCode)
proxy = "python3 cortex-proxy.py"

# Proxy build targets (requires rustup + target add for the chosen triple)
build-macos-intel = { cmd = "cargo build --release --target x86_64-apple-darwin", cwd = "cortex-proxy-rs", description = "Build macOS Intel binary" }
build-linux-x64 = { cmd = "cargo build --release --target x86_64-unknown-linux-gnu", cwd = "cortex-proxy-rs", description = "Build Linux x86_64 binary" }
build-linux-arm64 = { cmd = "cargo build --release --target aarch64-unknown-linux-gnu", cwd = "cortex-proxy-rs", description = "Build Linux ARM64 binary" }
build-windows-x64 = { cmd = "cargo build --release --target x86_64-pc-windows-gnu", cwd = "cortex-proxy-rs", description = "Build Windows x86_64 (GNU) binary" }
build-windows-arm64 = { cmd = "cargo build --release --target aarch64-pc-windows-gnullvm", cwd = "cortex-proxy-rs", description = "Build Windows ARM64 (GNU/LLVM) binary" }

[dependencies]
python = ">=3.11"
nodejs = ">=20"
curl = "*"
requests = ">=2.32.5,<3"
httpx = ">=0.28.1,<0.29"
rust = ">=1.92.0,<1.93"
cargo-zigbuild = "*"
zig = "*"
